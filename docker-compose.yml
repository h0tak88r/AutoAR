version: "3.8"

services:
  autoar-bot:
    build:
      context: .
      dockerfile: Dockerfile
      args:
        RUN_SETUP_AT_BUILD: "true"
    image: autoar-bot:latest
    container_name: autoar-bot
    restart: unless-stopped
    environment:
      - DISCORD_BOT_TOKEN=${DISCORD_BOT_TOKEN}
      - DISCORD_ONLY=${DISCORD_ONLY:-false}
      - RUN_SETUP=${RUN_SETUP:-false}
      - REGENERATE_CONFIG=${REGENERATE_CONFIG:-true}
      - AUTOAR_SCRIPT_PATH=/app/main.sh
      - AUTOAR_CONFIG_FILE=/app/autoar.yaml
      - AUTOAR_RESULTS_DIR=/app/new-results
      - GITHUB_TOKEN=${GITHUB_TOKEN:-}
      - SECURITYTRAILS_API_KEY=${SECURITYTRAILS_API_KEY:-}
      - SHODAN_API_KEY=${SHODAN_API_KEY:-}
      - VIRUSTOTAL_API_KEY=${VIRUSTOTAL_API_KEY:-}
      - WORDPRESS_API_KEY=${WORDPRESS_API_KEY:-}
      - BEVIGIL_API_KEY=${BEVIGIL_API_KEY:-}
      - BINARYEDGE_API_KEY=${BINARYEDGE_API_KEY:-}
      - URLSCAN_API_KEY=${URLSCAN_API_KEY:-}
      - CENSYS_API_ID=${CENSYS_API_ID:-}
      - CENSYS_API_SECRET=${CENSYS_API_SECRET:-}
      - CERTSPOTTER_API_KEY=${CERTSPOTTER_API_KEY:-}
      - CHAOS_API_KEY=${CHAOS_API_KEY:-}
      - FOFA_EMAIL=${FOFA_EMAIL:-}
      - FOFA_KEY=${FOFA_KEY:-}
      - FULLHUNT_API_KEY=${FULLHUNT_API_KEY:-}
      - INTELX_API_KEY=${INTELX_API_KEY:-}
      - PASSIVETOTAL_USERNAME=${PASSIVETOTAL_USERNAME:-}
      - PASSIVETOTAL_API_KEY=${PASSIVETOTAL_API_KEY:-}
      - QUAKE_USERNAME=${QUAKE_USERNAME:-}
      - QUAKE_PASSWORD=${QUAKE_PASSWORD:-}
      - SECURITYTRAILS_API_KEY=${SECURITYTRAILS_API_KEY:-}
      - THREATBOOK_API_KEY=${THREATBOOK_API_KEY:-}
      - VIRUSTOTAL_API_KEY=${VIRUSTOTAL_API_KEY:-}
      - WHOISXMLAPI_API_KEY=${WHOISXMLAPI_API_KEY:-}
      - ZOOMEYE_USERNAME=${ZOOMEYE_USERNAME:-}
      - ZOOMEYE_PASSWORD=${ZOOMEYE_PASSWORD:-}
      - ZOOMEYEAPI_API_KEY=${ZOOMEYEAPI_API_KEY:-}
      - H1_API_KEY=${H1_API_KEY:-}
      - INTEGRITI_API_KEY=${INTEGRITI_API_KEY:-}
      - DISCORD_WEBHOOK=${DISCORD_WEBHOOK:-}
      - SAVE_TO_DB=${SAVE_TO_DB:-true}
      - VERBOSE=${VERBOSE:-true}
      - DB_TYPE=${DB_TYPE:-postgresql}
      - DB_HOST=${DB_HOST}
      - DB_PORT=${DB_PORT:-5432}
      - DB_USER=${DB_USER}
      - DB_PASSWORD=${DB_PASSWORD}
      - DB_NAME=${DB_NAME:-autoar}
      - AUTOAR_DB=${AUTOAR_DB:-/app/autoar.db}
      - DOMAINS_COLLECTION=${DOMAINS_COLLECTION:-domains}
      - SUBDOMAINS_COLLECTION=${SUBDOMAINS_COLLECTION:-subdomains}
      - OPENROUTER_API_KEY=${OPENROUTER_API_KEY:-}
      - GITLAB_PROJECT_URL=${GITLAB_PROJECT_URL:-}
      - GITLAB_USERNAME=${GITLAB_USERNAME:-}
      - GITLAB_ACCESS_TOKEN=${GITLAB_ACCESS_TOKEN:-}
      - GITLAB_BRANCH=${GITLAB_BRANCH:-main}
      - USE_GITLAB_STORAGE=${USE_GITLAB_STORAGE:-false}
      - NUCLEI_TEMPLATES_PATH=/app/nuclei_templates
      - NUCLEI_RATE_LIMIT=${NUCLEI_RATE_LIMIT:-150}
      - NUCLEI_CONCURRENCY=${NUCLEI_CONCURRENCY:-25}
      - FFUF_WORDLIST_PATH=/app/Wordlists/quick_fuzz.txt
      - FFUF_THREADS=${FFUF_THREADS:-50}
      - SUBFINDER_THREADS=${SUBFINDER_THREADS:-10}
      - GITHUB_MAX_REPOS=${GITHUB_MAX_REPOS:-50}
      - GITHUB_PARALLEL_JOBS=${GITHUB_PARALLEL_JOBS:-3}
      - GITHUB_HTML_REPORTS=${GITHUB_HTML_REPORTS:-true}
      - GITHUB_SCAN_TYPES=${GITHUB_SCAN_TYPES:-github_org_scan}
    volumes:
      - results-data:/app/new-results
      - ./regexes:/app/regexes:ro
    healthcheck:
      test: ["CMD-SHELL", "python -c 'import importlib; importlib.import_module(\"discord\")' || exit 1"]
      interval: 30s
      timeout: 5s
      retries: 3
      start_period: 30s

volumes:
  results-data:


